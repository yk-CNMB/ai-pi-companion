<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pico AI Debug</title>
    <style>
        /* --- åŸºç¡€æ ·å¼ --- */
        body {
            font-family: sans-serif; margin: 0; padding: 0;
            display: flex; flex-direction: column; height: 100vh;
            background-color: #f0f0f0;
        }
        /* è°ƒè¯•åŒºåŸŸæ ·å¼ */
        #debug-log {
            background: #333; color: #0f0; font-family: monospace;
            padding: 5px; height: 60px; overflow-y: auto; font-size: 12px;
        }
        #chat-window { flex: 1; overflow-y: auto; padding: 10px; }
        .message-container { margin-bottom: 10px; }
        .pico { color: black; background: white; padding: 8px; border-radius: 10px; display: inline-block; max-width: 80%; }
        .user { color: white; background: blue; padding: 8px; border-radius: 10px; float: right; max-width: 80%; clear: both; }
        .audio-player { width: 100%; margin-top: 5px; height: 30px; }
        #input-area { display: flex; padding: 10px; background: #eee; }
        #user-input { flex: 1; padding: 10px; font-size: 16px; }
        #send-button { padding: 10px 20px; font-size: 16px; }
        .clearfix { clear: both; }
    </style>
</head>
<body>
    <div id="debug-log">è°ƒè¯•æ—¥å¿—å·²å¯åŠ¨...ç­‰å¾…è¿æ¥...</div>
    <div id="chat-window"></div>
    <div id="input-area">
        <input type="text" id="user-input" placeholder="å‘é€æ¶ˆæ¯..." autocomplete="off">
        <button id="send-button">å‘é€</button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.5/socket.io.js"></script>
    <script>
        const socket = io();
        const debugLog = document.getElementById('debug-log');
        const chatWindow = document.getElementById('chat-window');

        // --- è°ƒè¯•æ—¥å¿—å‡½æ•° ---
        function log(msg) {
            const line = document.createElement('div');
            line.textContent = `> ${new Date().toLocaleTimeString()}: ${msg}`;
            debugLog.appendChild(line);
            debugLog.scrollTop = debugLog.scrollHeight;
        }

        function appendMessage(text, sender) {
            const div = document.createElement('div');
            div.className = `message-container`;
            div.innerHTML = `<div class="${sender}">${text}</div><div class="clearfix"></div>`;
            chatWindow.appendChild(div);
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        // --- Socket äº‹ä»¶ ---
        socket.on('connect', () => log("âœ… å·²è¿æ¥åˆ°æœåŠ¡å™¨"));
        socket.on('disconnect', () => log("âŒ ä¸æœåŠ¡å™¨æ–­å¼€è¿æ¥"));
        socket.on('response', (data) => {
            log("æ”¶åˆ°æ–‡å­—æ¶ˆæ¯");
            appendMessage(data.text, 'pico');
        });

        // --- æ ¸å¿ƒéŸ³é¢‘è°ƒè¯• ---
        socket.on('audio_response', (data) => {
            log("ğŸµ æ”¶åˆ°éŸ³é¢‘ä¿¡å·! URL: " + data.audio);
            
            // å¼ºåˆ¶åœ¨èŠå¤©çª—å£æœ€ä¸‹æ–¹æ·»åŠ ä¸€ä¸ªæ’­æ”¾å™¨ï¼Œä¸ä¾èµ–ä»»ä½•ä¹‹å‰çš„å…ƒç´ 
            const audioDiv = document.createElement('div');
            audioDiv.innerHTML = `
                <div style="clear:both; margin-top: 5px;">
                    <span style="font-size:12px; color:#666;">Pico è¯­éŸ³:</span>
                    <audio class="audio-player" controls src="${data.audio}" autoplay></audio>
                </div>
            `;
            chatWindow.appendChild(audioDiv);
            chatWindow.scrollTop = chatWindow.scrollHeight;
        });

        // --- å‘é€ ---
        document.getElementById('send-button').addEventListener('click', () => {
            const text = document.getElementById('user-input').value;
            if (text) {
                appendMessage(text, 'user');
                socket.emit('message', {text});
                document.getElementById('user-input').value = '';
                log("å·²å‘é€: " + text);
            }
        });
    </script>
</body>
</html>
